<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../../skins/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../../../../00_mui/css/mui.min.css" rel="stylesheet" />
		<link href="../../../../00_mui/css/mescroll.min.css" rel="stylesheet" />
		<link href="../../../../01_common/css/load.css" rel="stylesheet" />
		<link href="../../../../01_common/css/common.css" rel="stylesheet" />

		<script src="../../../../00_mui/js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../../00_mui/js/mescroll.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../../00_mui/js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../../00_mui/js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../../01_common/js/load.js"></script>
		<script src="../../../../01_common/js/city.data.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../skins/js/bootstrap.min.js"></script>
		<script src="../../../../01_common/js/serviceUrl.js"></script>
		<script src="../../../../01_common/js/common.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="../../cform/skin/css/edoc-cform.css" />
		<!-- <link rel="stylesheet" type="text/css" href="css/banlijilu.css"/> -->
		<script type="text/javascript" src="../../cform/skin/js/mcform-all.js"></script>
		<!--
		<script type="text/javascript" src="../cform/skin/js/zepto.js"></script>
		<script type="text/javascript" src="../cform/skin/js/frame.js"></script>
		<script type="text/javascript" src="../cform/skin/js/mobiscroll.js"></script>
		<script type="text/javascript" src="../cform/skin/js/mcform.js"></script>
		
		<script type="text/javascript" src="../cform/tasklist/render/js/mformrender.js"></script>
		<script type="text/javascript" src="../cform/tasklist/action/mformaction.js"></script>-->
		<style type="text/css">
			#htmlContainer {
				margin-top: 20px;
				margin-left: -25px;
			}

			.file_photo {
				/*width: 107px;*/
				float: left;
			}

			.file_photo img {
				width: 64px;
				height: 64px;
				margin-left: 5px;
				border-radius: 10px;
				border: 0px;
			}

			.file_info {
				width: calc(100% - 100px);
				float: left;
			}

			.file_info p {
				color: #333;
				margin-bottom: 3px;
			}

			.file_name_n {
				font-size: 19px;
				overflow: none;
				word-wrap: break-word;
			}

			.file_name_t {
				font-size: 15px;
				float: right;
				color: grey;
			}

			.file_length {
				color: grey;
			}

			.file_detail {
				margin-bottom: 5px;
				margin-left: 10px;
				color: grey;
			}

			.file_fileType_folder {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -85px;
				background-position-y: -3px;
			}

			.file_fileType_pdf {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: 0px;
				background-position-y: -3px;
			}

			.file_fileType_doc {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -170px;
				background-position-y: 0px;
			}

			.file_fileType_music {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -293px;
				background-position-y: -538px;
			}

			.file_fileType_xls {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -256px;
				background-position-y: 0px;
			}

			.file_fileType_pic {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -342px;
				background-position-y: 0px;
			}

			.file_fileType_movie {
				background-image: url(../../skins/images/fileType.png);
				background-repeat: no-repeat;
				text-indent: -999em;
				background-position-x: -428px;
				background-position-y: 0px;
			}

			#fileList {
				padding-left: 5px;
				margin-top: 5px;
				margin-bottom: 5px;
			}

			#fileList li {
				list-style: none;
			}

			.clear {
				clear: both;
			}

			.cfDynTable {
				border: 0px;
			}

			.time {
				border: 1px solid #1E90FF;
				border-radius: 5px;
			}

			a:hover {
				text-decoration: none;
			}

			#tiyt {
				border-bottom: 1.5px solid #eee;
				height: 50px;
			}

			#infoName {
				padding-left: 20px;
				width: 160px;
				color: #7E7E7E
			}

			#val {
				padding-right: 20px;
				width: 160px;
			}

			#renderBackActors {
				float: left;
				width: 50%;
				color: #929292;
				margin-bottom: 20px;
			}

			.selepeople {
				margin: 2px 2px;
				background-color: #dfdfdf;
				padding: 0px 6px;
				border-radius: 5px;
				font-size: 0.8em;
				text-align: center;
				height: 40px;
				line-height: 40px;
				float: left;
			}

			.backSelepeople {
				margin: 2px 2px;
				background-color: #dfdfdf;
				padding: 0px 6px;
				border-radius: 5px;
				font-size: 0.8em;
				text-align: center;
				height: 40px;
				line-height: 40px;
				float: left;
			}

			.checkerSignCls {
				width: 100px;
				height: 100px;
				border: 1px, dashed;
			}

			.entSignCls {
				width: 100px;
				height: 100px;
				border: 1px, dashed;
			}

			.checkerSignClsDiv {
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				text-align: center;
				opacity: 0.7;
				height: 100%;
			}

			.beSigned,
			#beChecksignbeSigned {
				width: 30px;
				position: absolute;
				height: 30px;
				right: -5px;
				top: -12px;
				-webkit-transform: rotate(-5deg);
				transform: rotate(-5deg);
				border-radius: 50%;
			}

			.beSignedEnt {
				width: 30px;
				position: absolute;
				height: 30px;
				right: 1px;
				-webkit-transform: rotate(-5deg);
				transform: rotate(-5deg);
				border-radius: 50%;
			}

			.checkerSignParenCls,
			#beChecksignParentDiv {
				width: 100px;
				height: 100px;
				border: 1px dashed #ddd;
				background-color: #f2f2f2;
				overflow: hidden;
			}

			.checkerSignParenCls {
				margin: 0 0 5px 0;
			}

			#isLoadInvalidDiv.addInvalid label {
				color: #007aff;
			}

			#isLoadInvalidDiv.addInvalid input[type=checkbox]:before {
				background: url(../../../../images/checked1.png) no-repeat;
				background-size: 100% 100%;
			}

			#textList {
				background-color: rgba(244, 244, 244, 112);
				/*边角弧度*/
				border-radius: 20px;
			}

			#attachmentList {
				background-color: rgba(244, 244, 244, 112);
				/*边角弧度*/
				border-radius: 20px;
				margin-top: 5px;
			}

			.tr1 th {
				padding: 25px;
			}

			.tr1 td {
				padding-top: 30px !important;
				padding-right: 30px !important;
				font-size: 20px !important;
				border-top: 0px !important;
			}

			#downloadZwBtn {
				float: right;
				margin-right: 20px;
				border-radius: 30px;
			}

			#zexx {
				padding-top: 20px;
				padding-left: 10px;
			}

			#fjxx {
				padding-top: 20px;
				padding-left: 10px;
			}

			#tips {
				margin: 20px;
				background-color: rgba(255, 247, 198, 255);
				box-shadow: 0px 1px 3px rgba(34, 25, 25, 0.2);
				border-radius: 10px;
			}

			#ckzw {
				padding: 10px;
			}

			.arrow {
				position: absolute;
				width: 2rem;
				height: 2rem;
				margin-left: 25%;
				margin-top: 2%;
			}
			
		</style>
	</head>

	<body style="background: white;">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">公文办理</h1>
		</header>
		<div class="mui-content" style="background: white;">
			<div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="margin-top: 5px;">

				<a class="mui-control-item mui-active" href="#item1">办理区</a>
				<a class="mui-control-item" href="#item2">正文附件</a>
				<a class="mui-control-item" href="#item3">办理记录</a>
				<!-- <a id="banliquTab" class="mui-control-item" href="#item4">办理区</a> -->
			</div>
			<div id="" style="margin-top: 30px;">
				<div id="item1" style="margin-top: -30px;" class="mui-control-content  mui-active">
					<div id="htmlContainer" align="center">
						<!--<table v-for="htmlDb in htmlDbInfo.htmlDbRec">
							<tbody>
								<tr id="tiyt">
									<td id="infoName">当前流程</td>
									<td id="val" v-text="htmlDb.procName"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">当前环节</td>
									<td id="val" v-text="htmlDb.actName"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">当前处理人</td>
									<td id="val" v-text="htmlDb.actCurrentUsers"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">标题</td>
									<td id="val" v-text="htmlDb.subject"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">公文字号</td>
									<td id="val" v-text="htmlDb.wordNumber"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">紧急程度</td>
									<td id="val" v-text="htmlDb.instantLevel"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">密级</td>
									<td id="val">普通</td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">主送机关</td>
									<td id="val" v-text="htmlDb.mainSendOrgan"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">抄送机关</td>
									<td id="val" v-text="htmlDb.copySendOrgan"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">拟稿部门</td>
									<td id="val" v-text="htmlDb.drafterOrganName"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">拟稿人</td>
									<td id="val" v-text="htmlDb.drafterName"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">拟稿日期</td>
									<td id="val" v-text="htmlDb.drafterDate"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">签发人</td>
									<td id="val" v-text="htmlDb.approveName"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">印制份数</td>
									<td id="val" v-text="htmlDb.allowMinorNum"></td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">公开属性</td>
									<td id="val" v-if="htmlDb.publicProperty=='1'">主动公开</td>
									<td id="val" v-else-if="htmlDb.publicProperty=='2'">依申请公开</td>
									<td id="val" v-else-if="htmlDb.publicProperty=='3'">不予公开</td>
								</tr>
								<tr id="tiyt">
									<td id="infoName">公开形式</td>
									<td id="val" v-text="htmlDb.affair"></td>
								</tr>
							</tbody>
						</table>-->
					</div>
					<div id="banliqu" style="margin-top: 1%; margin-right: 20px;margin-left: -20px;">
						<img src="images/fg.png" style="width: 100%;">
						<ul>
							<li><span id="" style="float: left; color: #000000;margin-bottom: 20px;">
									办理意见
								</span>
								<span id="selecteview" style="float: right;" data-toggle="modal" data-target="#myModal">
									<a href="javascript:selectOption();">选择常用意见</a>
								</span>
								<!--<span id="addview" style="float: right;margin-right: 10px;">
								<a>增加常用意见</a>
							</span>-->
							</li>
							<!--<li><textarea id="banliyijian" placeholder="请输入办理意见"  style="overflow-y:hidden;overflow-x:hidden;border: 1;border-color: red;"></textarea></li>-->
							<div class="mui-input-row" style="margin: 5px 5px;">
								<textarea id="banliyijian" placeholder="请输入办理意见" class="mui-input mui-input-clear" style="overflow-y:hidden;overflow-x:hidden;border: 1;background-color: #F3F3F3;"></textarea>
							</div>
						</ul>
					</div>
					<div class="mui-card" style="display:none;">
						<div class="mui-card-header"></div>
						<div class="mui-card-content">
							<div class="mui-row" id="checkList" style="display:none;margin-left: 10px;">
								<div class="mui-col-sm-4 mui-col-xs-4" v-for="(checker,index) in checkerArr">
									<div style="position:relative" class="checkerSignParenCls" @tap="jumpDrawing('checker_sign_'+index);">
										<div class="backgroundImg" :id="'checker_sign_'+index+'p'">
											<p>请签批</p>
										</div>
										<img :id="'checker_sign_'+index" :checkerName="checker.userName" class="checkerSignCls mui-hidden" src="" />
										<div class="checkerSignClsDiv">
											<div class="userName">{{ checker.userName }}</div>
											<div :id="'checker_sign_'+index+'beSigned'" class="mui-hidden">
												<img class="beSigned" src="images/checked_new.png" />
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="mui-card" style="margin-top: 6%; margin-right: 20px;margin-left: -20px;display: none;">
						<ul>
							<li><span id="" style="float: left;font-size: 17px; color: #929292;margin-bottom: 20px;">
									办理人签批
								</span>
							</li>
							<div class="mui-card-content">
								<div style="position:relative;margin-left: 10px;" id="beChecksignParentDiv">
									<div class="backgroundImg" id="beChecksignp">
										<p>请签批</p>
									</div>
									<img src="" id="beChecksign" class="entSignCls mui-hidden" />
									<div id="beChecksignDiv" class="checkerSignClsDiv" style="color: #BBBBBB;">
										<div id="beChecksignbeSigned" class="mui-hidden">
											<img class="beSignedEnt" src="images/checked_new.png" />
										</div>
									</div>
								</div>
							</div>
						</ul>
					</div>
					<div id="banliqu2" style="margin-right: 20px;margin-left: -20px;">
						<img src="images/fg.png" style="width: 100%;">
						<ul>
							<li>
								<label style="font-weight:normal;color: #000000;margin-bottom: 20px;">下一环节及办理人</label>
							</li>

							<li>
								<div class="mui-input-row mui-checkbox" id="backArea">
									<input style="margin-right: 110px;" name="checkbox1" id="backCheck" type="checkbox">
									<label style="margin-left: -15px;font-weight:normal;color: #929292;margin-bottom: 20px;">退回之前环节</label>
								</div>
							</li>
							<li id="actsList" style="margin-top: -50px;">
								<div id="" style="float: left;width: 50%;color: #929292;margin-bottom: 20px;">
									<span id="">
										<label style="color:#31B6E7">></label>选择下一环节
									</span>
								</div>
								<div id="nextAct" style="float: right;width: 50%;margin-top: -11px;">
									<img src="images/select.png" class="arrow"/>
									<select id="nextSelAct" class="selectpicker select_search" onchange="renderOrgan()">
										<option v-for="nextRecord in actsInfo.actsRec" :value="nextRecord.actDefUniqueId">{{nextRecord.actDefName}}</option>
									</select>
									

								</div>
							</li>
							<li style="margin-top: -10px;">
								<div id="actorsList">
									<div id="" style="float: left;width: 50%;color: #929292;margin-bottom: 20px;">
										<span id="">
											<label style="color:#31B6E7">></label>下一环节办理人
										</span>
									</div>
									<div id="edit" style="float: right;width: 50%;text-align: right;">
										<span style="float: right;margin-right: 10px;">
											<a href="javascript:editNextActor();">编辑</a>
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											<a href="javascript:clearNextActor();">清空</a>
										</span>
									</div>

									<div class="onlyNextActors" id="nextActors" style="float:left;width:100%">
									</div>
								</div>
							</li>
							<!--退回环节-->
							<li id="backActList" style="display: none;margin-top: -50px;">
								<div id="" style="float: left;width: 50%;color: #929292;margin-bottom: 20px;">
									<span id="">
										<label style="color:#31B6E7">></label>选择退回环节
									</span>
								</div>
								<div id="backAct" style="float: right;width: 50%;margin-top: -11px;">
									
									<select id="backSelAct"  class="selectpicker">
										<option v-for="backActRecord in backActInfo.backActsRec" :actDefUniqueId="backActRecord.actDefUniqueId"
										 :activityId="backActRecord.activityId" :value="backActRecord.actDefUniqueId" v-text="backActRecord.actDefName"></option>
									</select>
									
								</div>
							</li>
							<li>
								<div id="backActorsList" style="display: none;margin-top: -10px;">
									<div id="" style="float: left;width: 50%;color: #929292;margin-bottom: 20px;">
										<span id="">
											<label style="color:#31B6E7">></label>退回环节办理人
										</span>
									</div>
									<div id="edit" style="float: right;width: 50%;text-align: right;">
										<span style="float: right;margin-right: 10px;">
											<a href="javascript:backActorEdit();">编辑</a>
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											<a href="javascript:clearBackNextActor();">清空</a>
										</span>
									</div>
									<div id="backNextActors" style="float:left;width:100%">
									</div>
								</div>
							</li>
						</ul>
						<img src="images/fgx.png">
						<div>
							<button type="button" style="left: 55%; width: 20%;border-radius: 20px;" class="mui-btn mui-btn-red" onclick="cancle()"
							 id="cancle">取消</button>
							<button type="button" style=" left: 55%;width: 20%;border-radius: 20px;" class="mui-btn mui-btn-blue" onclick="submit()"
							 id="sub">提交</button>
							<button type="button" style="left: 55%; width: 20%;border-radius: 20px;display: none;" class="mui-btn mui-btn-blue"
							 onclick="submitBack()" id="back">退回</button>
						</div>
					</div>
				</div>
				<div id="item2" class="mui-control-content" style="width: 90%;margin-left: 5%;">
					<div id="textList" style="margin-top: 6%; border-bottom: 1px solid #eee;padding-bottom: 50px; ">
						<div id="zexx">
							<span class="mui-icon mui-icon-compose" style="font-size: 30px;"></span><b style="font-size: 20;">正文信息</b>
						</div>
						<div>
							<div v-if="textInfo.status=='false'">
								<p style="padding-left: 10px;">无</p>
							</div>
							<div v-else>
								<table id="tableZW" class="table" style="font-size: 14px;vertical-align: middle;">
									<thead>
										<tr style="display: none;" class="tr1">
											<th>文件名</th>
											<th>大小/类型</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
										<tr class="tr1">
											<td style="display: none;">{{textInfo.fileName}}</td>
											<td style="display: none;">
												<span class="mui-badge mui-badge-purple">{{textInfo.fileSize}}</span>
												<span class="mui-badge mui-badge-purple">{{textInfo.fileType}}</span>
											</td>
										</tr>
									</tbody>
								</table>
								<div id="tips">
									<div id="ckzw">
										<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;点击“查看正文”时，手机可能会提示选择不同软件来打开正文，目前内文是word格式，外文是PDF格式，俩种格式都可以选择WPS软件打开。</span>
									</div>
								</div>
								<button id="downloadZwBtn" type="button" data-loading-text="下载中" data-loading-icon="mui-spinner mui-spinner-custom"
								 class="mui-btn mui-btn-danger" @tap="downloadfile('downloadZwBtn',textInfo.result)" @longtap="reDownloadfile('downloadZwBtn',textInfo.result)">查看正文</button>
							</div>
						</div>

					</div>
					<div id="fjxx">
						<span class="mui-icon mui-icon-download" style="font-size: 30px;"></span><b style="font-size: 20px;">附件信息</b>
					</div>
					<div id="attachmentList" style="border-bottom: 0px solid #eee;padding-bottom: 10px;padding-top: 5px;">
						<div>
							<div v-if="attachmentInfo.status=='false'">
								<p style="padding-left: 10px;">无</p>
							</div>
							<div v-else>
								<div>
									<table class="table" style="font-size: 14px;width: 100%;table-layout: fixed;">
										<thead>
											<tr style="display: none;" class="tr1">
												<th>文件名</th>
												<th>类型</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
											<div style="width: 100%;">
												<tr class="tr1" v-for="(attachmentRecord,index) in  attachmentInfo.attachmentRec">
													<td style="padding-left: 5px !important;width:50%;word-break: break-all; word-wrap: break-word;">{{attachmentRecord.name.substring(0,attachmentRecord.name.indexOf("."))}}</td>
													<td>
														<!-- <span class="mui-badge mui-badge-purple">{{attachmentRecord.size}}</span> -->
														<span class="mui-badge mui-badge-purple">{{attachmentRecord.mimeType.substring(1,attachmentRecord.mimeType.length)}}</span>
													</td>
													<td>
														<button :id="'downloadFjBtn'+index" type="button" data-loading-text="下载中" data-loading-icon="mui-spinner mui-spinner-custom"
														 class="mui-btn mui-btn-primary" style="border-radius: 30px;" @tap="downloadfile('downloadFjBtn'+index,attachmentRecord.url)"
														 @longtap="reDownloadfile('downloadFjBtn'+index,attachmentRecord.url)">查看</button>
													</td>
												</tr>
											</div>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div id="item3" class="mui-control-content">

					<div style="border-left:thick double #D9D9D9;height: 100%;width: 3px; float: left;background-color: red;"></div>
					<div id="opinionList" class="hovertree-trackrcol" style="margin-top: 6%;width: 80%;margin: 0 12%;height: 100%;border-left:2px solid #D9D9D9;">

						<div class="hovertree-tracklist" v-for="(opinionRecord,index) in opinionInfo.opinionRec" :key="index">

							<div style="margin-left: -6.3%;" v-if="index==0">
								<p style="background-color: red;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 7px"
									 src="../../../images/jin.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==1">
								<p style="background-color: #00cccc;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 5px"
									 src="../../../images/ju.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==2">
								<p style="background-color: #FFD39B;width: 30px;height: 30px;border-radius: 50px;margin-left:2.3%;"><img style="width: 20px;margin:0px 0px -6px 6px"
									 src="../../../images/zhu.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==3">
								<p style="background-color: #D8BFD8;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 6px"
									 src="../../../images/ping.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==4">
								<p style="background-color: #BCD2EE;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 5px"
									 src="../../../images/hui.png">
									<p>
										<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==5">
								<p style="background-color: #9BCD9B;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 5px"
									 src="../../../images/wan.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==6">
								<p style="background-color: #9BCD9B;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 6px"
									 src="../../../images/bian.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==7">
								<p style="background-color: #9BCD9B;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 6px"
									 src="../../../images/chuang.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<div style="margin-left: -6.3%;" v-if="index==8">
								<p style="background-color: #9BCD9B;width: 30px;height: 30px;border-radius: 50px;margin-left: 2.3%;"><img style="width: 20px;margin:0px 0px -6px 5px"
									 src="../../../images/ti.png"></p>
								<h4 style="margin-left: 45px;margin-top: -35px;">{{opinionRecord.actDefName}}</h4>
							</div>
							<p style="width: 10px;height: 10px;border-radius: 50%;background-color: #D9D9D9;margin-left: -5.5px;margin-top: 45px;"></p>
							<ul style="background-color: #F7F7F7;border-radius: 10px;margin-left:20px;width: 95%;margin-top: -45px;">
								<p class="first">

									<div id="item3-1" style="margin-left: -30px;width: 90%;word-wrap: break-word;">
										<!-- <div style="margin-top: 3px;color: #B6B6B6;" class="dealAct">办理环节：<span style="color: #2AC845;">{{opinionRecord.actDefName}}</span></div> -->
										<div style="margin-top: 3px;color: #B6B6B6;" class="dealPer">办理人：{{opinionRecord.opinionPerName}}</div>
										<div style="color: #B6B6B6;" class="dealOpinion">办理意见：<span style="color: #2AC845;">{{opinionRecord.opinion}}</span></div>
										<div style="margin-top: 3px;color: #B6B6B6;" class="dealTime">办理时间：{{opinionRecord.opinionTime}}</div>
									</div>
								</p>
							</ul>
						</div>
					</div>
				</div>

				<div id="item4" class="mui-control-content">

				</div>
			</div>
		</div>
		<!--<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					选择常用意见
				</h4>
			</div>
			<div class="modal-body">
				<label><input type=radio name=phone value=123 />123</label></br>
       			<label><input type=radio name=phone value=456 />456</label></br>
        		<label><input type=radio name=phone value=789 />789</label></br>
			</div>
		</div>
	</div>
	</div>-->
	</body>
	<script type="text/javascript">
		var mask = null;
		var checkerVm;
		var serialNo = "";
		var internalId = "";
		var formId = ""; //
		var actDefUniqueId = ""; //
		var formDataId = ""; //8a34a4396203280b01620339cb6a0395
		var procDefUniqueId = ""; //
		var formType = ""; //
		var taskType = ""; //
		var actDefId = ""; //
		var assignmentId = ""; //
		var submitType = "send"; //提交类型operateResult：create save send createAndSend loopSend jumpSend sign back finish
		//请求表单内容(html)的url
		var htmlUrl = "";
		var processId = "";
		var edocBaseId = ""; //ff808081639181160163aa748f2c01ed
		var _areaselect_data = "";
		var selectedName = "";
		var selectedId = "";
		var activityId = "";
		/**
		 * 页面数据模型构建
		 */
		var htmlListVm;
		var resourceListVm;
		var dealOpinionVm;
		var dealAttachmentVm;
		var dealTextVm;
		var nextActsVm;
		var htmlDbVm;
		var backActsVm;


		//办理区相关参数
		//委派类型 0普通人工环节的委派 1会签环节的非最终委派 2会签环节的最终委派
		var tfAssignmentType = '0';
		//环节位置 0首环节 1中间环节 2末环节
		var tfActivityPosition = '1';

		//业务类型
		var tfBusinessType;
		//当前环节名称
		var tfCurActDefName;
		//任务状态
		var tfTaskState;
		//末级环节判断
		var tfNextActivityRange = '';
		//流程扩展属性相关参数
		//扩展属性
		var extProp = {};

		function createValueModel() {
			htmlDbVm = new Vue({
				el: '#htmlContainer',
				data: {
					htmlDbInfo: {
						htmlDbRec: []
					}
				}
			});

			resourceListVm = new Vue({
				el: '#resourceList',
				data: {
					resourceInfo: {
						resouceRec: []
					}
				}
			});
			dealTextVm = new Vue({
				el: '#textList',
				data: {
					textInfo: {
						status: 'false',
						fileSize: '0',
						result: '',
						fileType: 'doc',
						fileName: '流程正文'
					}
				}
			});

			/*退回环节*/
			backActVm = new Vue({
				el: '#backActList',
				data: {
					backActInfo: {
						backActsRec: []
					}
				}
			});
			/*下一环节*/
			nextActsVm = new Vue({
				el: '#nextAct',
				data: {
					actsInfo: {
						actsRec: []
					}
				}
			});

			dealAttachmentVm = new Vue({
				el: '#attachmentList',
				data: {
					attachmentInfo: {
						attachmentRec: []
					}
				}
			});
			dealOpinionVm = new Vue({
				el: '#opinionList',
				data: {
					opinionInfo: {
						isLoad: false,
						opinionRec: []
					}
				}
			});

		}

		//渲染表单（包括表单数据、数据绑定、表单域权限控制）
		var formRenderUrl = "";
		mui.plusReady(function() {
			mui.init({
				gestureConfig: {
					tap: true, //默认为true
					doubletap: true, //默认为false
					longtap: true, //默认为false
					swipe: true, //默认为true
					drag: true, //默认为true
					hold: false, //默认为false，不监听
					release: false //默认为false，不监听
				}
			});
			createValueModel();
			regEvents();
			var self = plus.webview.currentWebview();
			internalId = self.id;
			procDefUniqueId = self.procDefUniqueId;
			formType = self.formType;
			formId = self.formId;
			taskType = self.taskType;
			if (taskType == undefined || taskType == null || taskType == "") {
				taskType = "01";
			}
			if (taskType != "01") {
				$("#banliquTab").hide();
			}
			actDefUniqueId = self.actDefUniqueId;
			actDefId = self.actDefId;
			formDataId = self.formDataId;
			assignmentId = self.assignmentId;
			//submitType = self.submitType;
			processId = self.processId;
			selectedName = self.selectedName;
			selectedId = self.selectedId;
			initFormData();
			//CForm.setFormReadOnly();
			mask = mui.createMask();
		});

		//跳到签批页面
		function jumpDrawing(id) {
			plus.nativeUI.showWaiting("");
			var returnJson = {
				signId: id
			};
			//获取当前页面id
			mui.openWindow({
				id: "01_common/html/sign/drawing.html",
				url: "../../../../01_common/html/sign/drawing.html",
				extras: {
					callbackPageId: plus.webview.currentWebview().id,
					callbackPageEvent: "lodCanvas",
					returnJsonStr: JSON.stringify(returnJson)
				},
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: true, //自动显示等待框，默认为true
				}
			});
		}

		/**
		 * 页面事件注册
		 */
		function regEvents() {
			/****
			 * 删除已选中人员
			 * */
			mui(".onlyNextActors").on("tap", ".selepeople", function(event) {
				document.activeElement.blur();
				this.remove();
			});

			mui("#backNextActors").on("tap", ".backSelepeople", function(event) {
				document.activeElement.blur();
				this.remove();
			});
			//选择常用意见回调
			window.addEventListener("initSelectOption", function(event) {
				mask.show();
				setTimeout(function() {
					var checker = event.detail.checker;
					$("#banliyijian").val(checker);

					mask.close();
					plus.nativeUI.closeWaiting();
				}, 20);
			});

			//选择下一环节办理人回调
			window.addEventListener("initNextActPerson", function(event) {
				mask.show();
				setTimeout(function() {
					var checker = event.detail.checker;
					var organList = JSON.parse(checker);

					for (var i = 0; i < organList.length; i++) {
						var newEle = document.createElement("span");
						newEle.id = "organSearchInput_" + organList[i].organId;
						newEle.value = organList[i].organId;
						newEle.organId = organList[i].organId;
						newEle.organName = organList[i].organName;
						newEle.type = "search";
						newEle.className = "mui-icon mui-icon-closeempty selepeople";
						newEle.innerText = organList[i].organName;
						var searchPersonInput = document.getElementById("nextActors");
						searchPersonInput.appendChild(newEle);
					}
					mask.close();
					plus.nativeUI.closeWaiting();
				}, 20);
			});
			//选择下一环节办理人回调
			window.addEventListener("initBackActPerson", function(event) {
				mask.show();
				setTimeout(function() {
					var checker = event.detail.checker;
					var organList = JSON.parse(checker);

					for (var i = 0; i < organList.length; i++) {
						var newEle = document.createElement("span");
						newEle.id = "organSearchInput_" + organList[i].organId;
						newEle.value = organList[i].organId;
						newEle.organId = organList[i].organId;
						newEle.organName = organList[i].organName;
						newEle.type = "search";
						newEle.className = "mui-icon mui-icon-closeempty backSelepeople";
						newEle.innerText = organList[i].organName;
						var searchPersonInput = document.getElementById("backNextActors");
						searchPersonInput.appendChild(newEle);
					}
					mask.close();
					plus.nativeUI.closeWaiting();
				}, 20);
			});

			//退回之前环节点击触发
			$("#backCheck").click(function() {
				//点击退回是加载退回环节以及退回环节办理人
				renderBackAct();

				$("#back").show();
				$("#backActList").show();
				$("#backActorsList").show();
				$("#sub").hide();
				$("#actorsList").hide();
				$("#actsList").hide();
				if ($("[name = 'checkbox1']:checkbox:checked").length == 0) {
					$("#back").hide();
					$("#backActList").hide();
					$("#backActorsList").hide();
					if (submitType != "finish") {
						$("#actorsList").show();
					}
					$("#sub").show();

					$("#actsList").show();
					return;
				}
			});



			//返回回来要执行的方法   
			function fun1(e) {
				var val = e.detail.param.selectedName;

				alert(val);
				$("#aname").text(val);
				alert("aaaaa");
			}
			window.addEventListener('doit', fun1);

			$('#addview').click(function(event) {
				var name = prompt("新增办理意见"); // 弹出input框  
			});

			$('#selecteview').click(function(event) {
				selectOption();
			});

			//签批弹出页签批完毕后更新本页签批区
			window.addEventListener("lodCanvas", function(event) {
				//签批完成后保持竖屏
				//plus.screen.lockOrientation("portrait-primary");
				var url = event.detail.canvas;
				var returnJson;
				if (event.detail.loadFromTemporary) {
					returnJson = event.detail.returnJsonStr;
				} else {
					returnJson = JSON.parse(event.detail.returnJsonStr);
				}
				var signId = returnJson.signId;
				var signIdp = document.getElementById(signId + "p");
				if (signIdp != null && signIdp != undefined) {
					signIdp.style.display = "none";
				}
				var signIdEle = document.getElementById(signId);
				signIdEle.src = url;
				if (!signIdEle.classList.contains("signed")) {
					signIdEle.classList.add("signed");
				}
				signIdEle.classList.remove("mui-hidden");
				var divshow = document.getElementById(signId + "beSigned");
				//签批完成后隐藏原来姓名
				divshow.classList.remove("mui-hidden");
				var preDiv = divshow.previousElementSibling;
				if (preDiv != null) {
					preDiv.style.display = "none";
				}
				//divshow.parentNode.style.display = "none";
			});
			//被检查人签批
			mui("#beChecksignParentDiv")[0].addEventListener("tap", function() {
				jumpDrawing("beChecksign");
			});
		};

		function initFormData() { //调用接口获取 相关参数
			renderHtml();
			renderText();
			renderAttachment();
			renderOpinion();
			if (taskType == "01") {
				//只有待办才加载办理区
				//renderNext();
				initTransactArea();
			}
		}



		/**
		 * 渲染表单内容(html)
		 */
		function renderHtml() {
			//请求表单内容(html)的url
			htmlUrl = baseServiceUrl.edocUrl + "/jsp/cform/output/" + formId + ".html?r=" + Math.random();
			//渲染表单（包括表单数据、数据绑定、表单域权限控制）
			formRenderUrl = baseServiceUrl.edocUrl + "/command/dispatcher/" +
				"org.loushang.cform.tasklist.cmd.RenderDispatcherCmd/renderForm" +
				"?actDefUniqueId=" + actDefUniqueId + "&formId=" + formId + "&formDataId=" + formDataId;
			//console.log("formDataId//:"+formDataId);
			var htmlCfg = {
				url: htmlUrl,
				success: function(data, textStatus) {
					// 添加云表单
					$("#htmlContainer").html("");
					$("#htmlContainer").append(data);
					// 云表单加载完毕后需要执行的初始化操作
					CForm.init();
					// 渲染表单
					renderForm();
					
					//renderstatrs();
				},
				async: true
			};

			//$.ajax(htmlCfg);
			mui.ajax(htmlCfg);
			/*	mui.ajax(baseServiceUrl.url,{
					data: {
						serviceCode : "edoc.queryEdocDaiBanDetailBD",
						processId :processId
					},
					dataType: 'json',
					headers : {
						 'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
					},
					type: "post",
					timeout: 300000, //超时时间设置为10秒；
					success: function(datas) {
						
						if(datas.errMsg){
							plus.nativeUI.toast(datas.errMsg);
							return;
						}
						if(datas.result==""){
							return;
						}
						if(datas.result.indexOf("\r\n\r\n<html>")==0){
							return;
						}
						var data = JSON.parse(datas.result);
						if(data.errMsg){
							plus.nativeUI.toast(data.errMsg);
							return;
						}
					
						htmlDbVm.htmlDbInfo.start = htmlDbVm.htmlDbInfo.start+1;
						htmlDbVm.htmlDbInfo.entTotal = data.totalCount;
						var htmlDbList = data.result;
							htmlDbVm.htmlDbInfo.htmlDbRec.push({
								subject : htmlDbList.subject,
								procName : htmlDbList.procName,//流程名称
								actName : htmlDbList.actName,//当前环节名称
								actCurrentUsers: htmlDbList.actCurrentUsers,//处理人
								wordNumber: htmlDbList.wordNumber,//公文字号
								instantLevel:htmlDbList.instantLevel,//紧急程度
								mainSendOrgan:htmlDbList.mainSendOrgan,//主送机关
								copySendOrgan:htmlDbList.copySendOrgan,//抄送
								drafterOrganName:htmlDbList.drafterOrganName,//拟稿部门
								drafterName:htmlDbList.drafterName,//拟稿人
								drafterDate:htmlDbList.drafterDate,//拟稿日期
								approveName:htmlDbList.approveName,//签发人
								allowMinorNum:htmlDbList.allowMinorNum,//印制份数
								affair:htmlDbList.affair,//公开形式
								publicProperty:htmlDbList.publicProperty,//公开属性
								
							});
					},
					error: function(xhr, type, errorThrown) {
						mui.toast("获取数据失败,请检查网络是否畅通");
					}
				});*/
		}
		
		// function renderstatrs(){
		// 	window.setInterval( queryjiazai, 1000 * 2 ); 
						
		// }
		// function queryjiazai(){
		// 	var status1="无须公平竞争审查";
		// 	var status2="不违法18条标准任何一项";
		// 	var status3="违反标准但符合例外规定";
		// 	var name=document.getElementById("GongPingJingZhengShenChaXuanXi").value.replace("undefined");
		// 	if(name=="1"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status1;
		// 	}else if(name=="2"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status2;
		// 	}else if(name=="3"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status3;
		// 	}else if(name=="1,2"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status1+","+status2;
		// 	}else if(name=="2,3"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status2+","+status3;
		// 	}else if(name=="1,3"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status1+","+status3;
		// 	}else if(name=="1,2,3"){
		// 		document.getElementById("GongPingJingZhengShenChaXuanXi").value=status1+","+status2+","+status3;
		// 	}
		// }


		function renderOpinion() {
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocDaibanDetailBLJL",
					assignmentId: assignmentId,
					start: '0',
					limit: '100'
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					//console.log("datas"+JSON.stringify(datas))
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}
					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}

					dealOpinionVm.opinionInfo.start = dealOpinionVm.opinionInfo.start + 1;
					dealOpinionVm.opinionInfo.entTotal = data.totalCount;
					var opinionInfoList = data.result;
					for (var i = 0; i < opinionInfoList.length; i++) {
						dealOpinionVm.opinionInfo.opinionRec.push({
							opinionPerName: opinionInfoList[i].OPINIONPERSON,
							createTime: opinionInfoList[i].CREATE_TIME,
							opinion: opinionInfoList[i].OPINION,
							actDefName: opinionInfoList[i].ACT_DEF_NAME,
							opinionTime: opinionInfoList[i].OPINIONTIME
						});
					}
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}

		//正文
		function renderText() {
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocDaibanDetailZW",
					assignmentId: assignmentId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {

					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}
					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}

					dealTextVm.textInfo.status = data.status;
					if (data.status != 'false') {
						dealTextVm.textInfo.fileSize = data.fileSize;
						dealTextVm.textInfo.result = data.result;
						if (null !== data.fileType && undefined !== data.fileType && "" !== data.fileType) {
							dealTextVm.textInfo.fileType = data.fileType;
						}
						dealTextVm.textInfo.fileName = data.fileName;
					}

				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		//附件
		function renderAttachment() {
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocDaibanDetailFJ",
					assignmentId: assignmentId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					//console.log("获取附件" + JSON.stringify(datas));
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}
					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}
					var fjData = data.result;

					dealAttachmentVm.attachmentInfo.start = dealAttachmentVm.attachmentInfo.start + 1;
					dealAttachmentVm.attachmentInfo.entTotal = fjData.totalCount;
					dealAttachmentVm.attachmentInfo.status = data.status;
					for (var i = 0; i < fjData.length; i++) {
						dealAttachmentVm.attachmentInfo.attachmentRec.push({
							mimeType: fjData[i].fileType,
							name: fjData[i].fileName,
							//size : fjData[i].size,
							url: fjData[i].fileUrl,
							//thumbnailUrl:fjData[i].thumbnail_url,
							//upTime:fjData[i].up_time,
							//upUser:fjData[i].up_user,
							//uuid:fjData[i].uuid
						});
					}
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		//选择常用意见
		function selectOption() {
			mui.openWindow({
				id: "12_edoc/html/edoc/tasklist/render/optionSelect.html",
				url: "optionSelect.html",
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: false, //自动显示等待框，默认为true
				},
				extras: {
					procDefUniqueId: procDefUniqueId,
					organId: localStorage.getItem("employeeOrganId"),
					callbackPageId: "12_edoc/html/edoc/tasklist/render/formrender.html",
					callbackPageEvent: "initSelectOption",
					isUseDataPermit: "0"
				}
			});
		};



		//加载办理区
		function initTransactArea() {
			initAssignmentInfo();
		}

		function initAssignmentInfo() {
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocAssignmentInfo",
					assignmentId: assignmentId,
					//procDefUniqueId:procDefUniqueId,
					//actDefId:actDefId,
					//actDefUniqueId:actDefUniqueId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					//console.log("获取queryCurrentAssignmentInfo" + JSON.stringify(datas));
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}

					var assignmentInfo = JSON.parse(datas.result);
					if (assignmentInfo.errMsg) {
						plus.nativeUI.toast(assignmentInfo.errMsg);
						return;
					}
					assignmentInfo = assignmentInfo.result;
					//任务状态
					tfTaskState = assignmentInfo.taskState;
					//业务类型
					tfBusinessType = assignmentInfo.businessType;
					//委派类型
					tfAssignmentType = assignmentInfo.assignmentType;
					//环节位置
					tfActivityPosition = assignmentInfo.activityPosition;
					//当前环节名称
					tfCurActDefName = assignmentInfo.curActDefName;
					//扩展属性
					//extProp = JSON.parse(assignmentInfo.extProp);
					extProp = assignmentInfo;
					if (extProp.hasOption ? true : extProp.hasOption == "1") {
						$("#banliyijian").css("border-color", "red");
					}
					tfNextActivityRange = !extProp.nextActivityRange ? "1" : extProp.nextActivityRange;

					if (tfActivityPosition == "2" && tfNextActivityRange == "1") {
						$("#nextAct").html("当前环节为最终环节！");
						hideNextActorsArea();
						//$("#nextActivityTd").mask("当前环节为最终环节！");
						//$("#nextActorTd").mask("当前环节为最终环节！");
						//$("#tfSaveAndSend").text(G3.BPM.tranBtnText.FINISH);
						$("#sub").text("办结");

						submitType = "finish";
					} else {

						if (tfActivityPosition == "0") { //|| !tfArea.tfIsAllowedBack()
							//首环节，禁用回退时，隐藏回退多选框
							hideBackArea();
						}
						if ("1" == tfAssignmentType) {
							hideBackArea();
							hideNextActorsArea();
							$("#nextAct").html("当前环节为会签环节！");
							//$("#nextActorTd").mask("当前环节为会签环节！");
							//$("#tfSaveAndSend").text(G3.BPM.tranBtnText.SIGN);
							submitType = "sign";
						} else {
							//								if(urlData.assignmentId == ""){
							//									operateResult.submitType = G3.BPM.submitType.CREATE_AND_SEND;
							//								}
							//								else if (nextActRange == G3.BPM.nextActRange.PROCESS){
							//									operateResult.submitType = G3.BPM.submitType.SEND;
							//								}
							//								else if (nextActRange == G3.BPM.nextActRange.LOOP){
							//									operateResult.submitType = G3.BPM.submitType.LOOP_SEND;
							//								}
							//								else if (nextActRange == G3.BPM.nextActRange.ALL){
							//									operateResult.submitType = G3.BPM.submitType.JUMP_SEND;
							//								}
						}

						renderNext();
					}


				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		//下一环节
		function renderNext() {
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocNextActs",
					assignmentId: assignmentId,
					submitType: submitType
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					console.log("获取的下一环节信息" + JSON.stringify(datas))
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}

					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}

					var nextList = data.result;

					if (submitType == "sign") {
						//renderOrgan(actDefUniqueId);
					} else {
						for (var i = 0; i < nextList.length; i++) {
							nextActsVm.actsInfo.actsRec.push({
								splitType: nextList[i].splitType,
								organId: nextList[i].organId,
								organName: nextList[i].organName,
								actDefName: nextList[i].actDefName,
								assignmentType: nextList[i].assignmentType,
								actType: nextList[i].actType,
								actDefUniqueId: nextList[i].actDefUniqueId,
								actDefId: nextList[i].actDefId,
								assignRuleType: nextList[i].assignRuleType
							});
						}
						if (nextList[0].actDefName != "会签") {
							renderOrgan(nextList[0].actDefUniqueId);
						}

					}

				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		//页面加载时加载Map信息
		var actOrganMap = new Map();

		//下一环节办理人
		function renderOrgan(nextActId) {
			if (nextActId == undefined || nextActId == null) {
				nextActId = $("#nextSelAct option:selected").val();
			}
		
				
			
			if (actOrganMap.has(nextActId)) {
				var organList = actOrganMap.get(nextActId);
				for (var i = 0; i < organList.length; i++) {
					var newEle = document.createElement("span");
					newEle.id = "organSearchInput_" + organList[i].organId;
					newEle.value = organList[i].organId;
					newEle.organId = organList[i].organId;
					newEle.organName = organList[i].organName;
					newEle.type = "search";
					newEle.className = "mui-icon mui-icon-closeempty selepeople";
					newEle.innerText = organList[i].organName;
					var searchPersonInput = document.getElementById("nextActors");
					searchPersonInput.appendChild(newEle);
				}
				return;
			}

			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryEdocNextActors",
					assignmentId: assignmentId,
					actDefUniqueId: nextActId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
						if(nextActId!="ff8080816a2a4e0b016a331f368f070a"){
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}
					
					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}
					var organList = data.result;
					actOrganMap.set(nextActId, organList);
					var organList = actOrganMap.get(nextActId);
					for (var i = 0; i < organList.length; i++) {
						var newEle = document.createElement("span");
						newEle.id = "organSearchInput_" + organList[i].organId;
						newEle.value = organList[i].organId;
						newEle.organId = organList[i].organId;
						newEle.organName = organList[i].organName;
						newEle.type = "search";
						newEle.className = "mui-icon mui-icon-closeempty selepeople";
						newEle.innerText = organList[i].organName;
						var searchPersonInput = document.getElementById("nextActors");
						searchPersonInput.appendChild(newEle);
					}
					}
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
			
		}

		/*选择下一环节办理人*/
		function editNextActor() {
			mui.openWindow({
				id: "01_common/html/organ/organSelect.html",
				url: "../../../../01_common/html/organ/organSelect.html",
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: false, //自动显示等待框，默认为true
				},
				extras: {
					callbackPageId: "12_edoc/html/edoc/tasklist/render/formrender.html",
					callbackPageEvent: "initNextActPerson",
					isUseDataPermit: "1"
				}
			});
		};

		function clearNextActor() {
			var searchPersonInput = document.getElementById("nextActors");
			searchPersonInput.innerHTML = "";
		}
		var isLoadReturnAct = false;

		//退回环节
		function renderBackAct() {
			if (isLoadReturnAct) {
				return;
			}
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryHistoryActivity",
					assignmentId: assignmentId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}

					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}

					var backActList = data.result;
					for (var i = 0; i < backActList.length; i++) {
						backActVm.backActInfo.backActsRec.push({
							activityId: backActList[i].activityId,
							actDefName: backActList[i].actDefName,
							actDefUniqueId: backActList[i].actDefUniqueId,
							actDefId: backActList[i].actDefId,
							actType: backActList[i].actType

						});
					}
					renderBackActors(backActList[0].activityId);
					isLoadReturnAct = true;
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}

		//退回环节办理人
		var isLoadReturnPerson = false;

		function renderBackActors(backActivityId) {
			if (backActivityId == undefined || backActivityId == null || backActivityId == "") {
				backActivityId = $("#backSelAct  option:selected").attr("activityId");
			}
			if (isLoadReturnPerson) {
				retrun;
			}
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.queryHistoryActivityEmployee",
					activityId: backActivityId
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						return;
					}
					if (datas.result == "") {
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						return;
					}
					var data = JSON.parse(datas.result);
					if (data.errMsg) {
						plus.nativeUI.toast(data.errMsg);
						return;
					}
					var organList = data.result;
					for (var i = 0; i < organList.length; i++) {
						var newEle = document.createElement("span");
						newEle.id = "organSearchInput_" + organList[i].organId;
						newEle.value = organList[i].organId;
						newEle.organId = organList[i].organId;
						newEle.organName = organList[i].organName;
						newEle.type = "search";
						newEle.className = "mui-icon mui-icon-closeempty backSelepeople";
						newEle.innerText = organList[i].organName;
						var searchPersonInput = document.getElementById("backNextActors");
						searchPersonInput.appendChild(newEle);
					}
					isLoadReturnPerson = true;
				},
				error: function(xhr, type, errorThrown) {
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		/*选择退回环节办理人*/
		function backActorEdit() {
			//			var param = { //这是要传的数据 
			//				activityId:activityId,
			//				processId:processId ,
			//				edocBaseId:edocBaseId ,
			//				assignmentId:assignmentId ,
			//				submitType:submitType,
			//				actDefUniqueId:actDefUniqueId 
			//				}; 
			//				mui.openWindow({//目标页面 
			//				url:'transact.html', 
			//				id: 'transact.html', 
			//				extras: param 
			//			}); 
			mui.openWindow({
				id: "01_common/html/organ/organSelect.html",
				url: "../../../../01_common/html/organ/organSelect.html",
				show: {
					aniShow: 'pop-in'
				},
				waiting: {
					autoShow: false, //自动显示等待框，默认为true
				},
				extras: {
					callbackPageId: "12_edoc/html/edoc/tasklist/render/formrender.html",
					callbackPageEvent: "initBackActPerson",
					isUseDataPermit: "0"
				}
			});
		};

		function clearBackNextActor() {
			var searchPersonInput = document.getElementById("backNextActors");
			searchPersonInput.innerHTML = "";
		}
		var dtask = null;

		function downloadfile(eleId, filePath) {
			mui("#" + eleId).button('loading');
			if (localStorage.getItem("EDOCZW" + filePath) != null) {
				filename = localStorage.getItem("EDOCZW" + filePath);
				plus.runtime.openFile(filename, {}, function(e) {
					//调用第三方应用打开文件
					mui.toast("文件打开失败" + filename);
					localStorage.removeItem("EDOCZW" + filePath);
				});
				mui("#" + eleId).button('reset'); //切换为reset状态(即重置为原始的button)
				return;
			}
			var downPath = '';
			if (filePath.indexOf("http") > -1) {
				downPath = filePath;
			} else {
				downPath = baseServiceUrl.cfileUrl + "/" + filePath;
			}
			console.log("文件下载路径" + downPath)
			dtask = plus.downloader.createDownload(downPath, {}, function(d, status) {
				// 下载完成  
				if (status == 200) {
					localStorage.setItem("EDOCZW" + d.filename, d.filename);
					plus.runtime.openFile(d.filename, {}, function(e) {
						//调用第三方应用打开文件
						mui.toast("文件打开失败" + d.filename);
						localStorage.removeItem("EDOCZW" + d.filename);
					});
				} else {
					localStorage.removeItem("EDOCZW" + d.filename);
					mui.toast("文件下载失败，请检查网络");
				}
				mui("#" + eleId).button('reset'); //切换为reset状态(即重置为原始的button)
			});
			dtask.setRequestHeader('Cookie', 'JSESSIONID=0000' + localStorage.getItem("sessionId")); // 设置POST请求提交的数据类型为JSON字符串
			dtask.start();
		}

		function reDownloadfile(eleId, filePath) {
			mui("#" + eleId).button('loading');
			var downPath = '';
			if (filePath.indexOf("http") > -1) {
				downPath = filePath;
			} else {
				downPath = baseServiceUrl.cfileUrl + "/" + filePath;
			}
			dtask = plus.downloader.createDownload(downPath, {}, function(d, status) {
				// 下载完成
				if (status == 200) {
					localStorage.setItem("EDOCZW" + d.filename, d.filename);
					plus.runtime.openFile(d.filename, {}, function(e) {
						//调用第三方应用打开文件
						mui.toast("文件打开失败" + d.filename);
						localStorage.removeItem("EDOCZW" + d.filename);
					});
				} else {
					mui.toast("文件下载失败，请检查网络");
				}
				mui("#" + eleId).button('reset'); //切换为reset状态(即重置为原始的button)
			});
			/*		    dtask.addEventListener("statechanged",function(task,status){
					            if(!dtask){return;}
					            switch(task.state){
					                case 1: mui.toast('开始下载...');break;//开始
					                case 2: mui.toast('链接到服务器...');break;//链接到服务器
					                case 3:
					                    var progressVal = (task.downloadedSize/task.totalSize)*100;
					                        mui('#bar').progressbar({progress:progressVal}).show();
					                    break;
					                case 4: mui.toast('下载完成');break;
					            }
					        });*/
			dtask.setRequestHeader('Cookie', 'JSESSIONID=0000' + localStorage.getItem("sessionId")); // 设置POST请求提交的数据类型为JSON字符串
			dtask.start();
		}

		function hideBackArea() {
			$("#backArea").hide();
		}

		function hideNextActorsArea() {
			$("#actorsList").hide();
		}
		//提交
		function submit() {
			mask.show();
			var opinion = $("#banliyijian").val();
			if (extProp.hasOption ? true : extProp.hasOption == "1") {
				if (opinion == "") {
					plus.nativeUI.alert("请填写办理意见！", function() {}, baseConfig.alerttitle, "确定");
					mask.close();
					return;
				}
			}

			var nextAct = '';
			var nextActId = '';
			var nextActors = '';
			if (submitType != "sign" && submitType != "finish") {
				nextAct = $("#nextSelAct  option:selected").text();
				nextActId = $("#nextSelAct  option:selected").val();
				nextActors = ''; //定义一个参数
				$("#nextActors").find(".selepeople").each(function(i, obj) { //遍历
					nextActors += obj.organId + ","; //获取id
				});
				if (nextActors != "") {
					nextActors = nextActors.substring(0, nextActors.length - 1); //去掉多余的逗号
				}

				if (nextAct == "") {
					plus.nativeUI.alert("请选择下一环节！", function() {}, baseConfig.alerttitle, "确定");
					mask.close();
					return;
				}

				if (nextActors == "" || nextActors == undefined) {
					plus.nativeUI.alert("请选择下一环节处理人！", function() {}, baseConfig.alerttitle, "确定");
					mask.close();
					return;
				}
			}


			plus.nativeUI.showWaiting("正在提交，请稍候");
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.submitDaibanTask",
					assignmentId: assignmentId,
					actDefUniqueId: nextActId,
					nextActorId: nextActors,
					//submitType:submitType,
					opinion: opinion
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					if (datas.errMsg) {
						plus.nativeUI.toast(datas.errMsg);
						mask.close();
						plus.nativeUI.closeWaiting();
						return;
					}
					if (datas.result == "") {
						mask.close();
						plus.nativeUI.closeWaiting();
						return;
					}

					if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
						mask.close();
						plus.nativeUI.closeWaiting();
						return;
					}

					if (datas.result ==
						"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
					) {
						plus.nativeUI.toast("您已下线，请重新登录");
						mask.close();
						plus.nativeUI.closeWaiting();
						return;
					}
					try {
						var data = JSON.parse(datas.result);
						if (data.status == "true") {
							//获得列表界面的webview
							var taskExecPage = plus.webview.getWebviewById('12_edoc/html/edoc/tasklist/daiban/daiban.html');
							//触发列表界面的自定义事件（refresh）,从而进行数据刷新
							mui.fire(taskExecPage, 'initLoadParams', {});
							mui.alert("提交成功！", function() {
								mui.openWindow({
									id: "12_edoc/html/edoc/tasklist/daiban/daiban.html",
									url: "../daiban/daiban.html",
									show: {
										aniShow: 'pop-in',
										duration: 250
									},
									waiting: {
										autoShow: false, //自动显示等待框，默认为true
									},
									styles: {
										cachemode: "noCache"
									}
								});
								plus.webview.currentWebview().close();
							});

							mask.close();
							plus.nativeUI.closeWaiting();
							//plus.webview.currentWebview().close();
						}

						if (data.errMsg) {
							plus.nativeUI.toast(data.errMsg);
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}
					} catch (err) {
						plus.nativeUI.toast("系统错误，无法进行提交操作");
						plus.nativeUI.closeWaiting();
						mask.close();
					}

				},
				error: function(xhr, type, errorThrown) {
					plus.nativeUI.closeWaiting();
					mask.close();
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});

		}

		function submitBack() {
			var opinion = $("#banliyijian").val();
			if (extProp.hasOption ? true : extProp.hasOption == "1") {
				if (opinion == "") {
					plus.nativeUI.alert("请填写办理意见！", function() {}, baseConfig.alerttitle, "确定");
					mask.close();
					return;
				}
			}
			var nextActors = ''; //定义一个参数
			$("#backNextActors").find(".backSelepeople").each(function(i, obj) { //遍历
				nextActors += obj.organId + ","; //获取id
			});
			if (nextActors != "") {
				nextActors = nextActors.substring(0, nextActors.length - 1); //去掉多余的逗号
			}
			var nextAct = $("#backSelAct  option:selected").text();
			var nextActId = $("#backSelAct  option:selected").val();

			if (nextAct == "") {
				plus.nativeUI.alert("请选择下一环节！", function() {}, baseConfig.alerttitle, "确定");
				mask.close();
				return;
			}
			if (nextActors == "") {
				plus.nativeUI.alert("请选择下一环节处理人！", function() {}, baseConfig.alerttitle, "确定");
				mask.close();
				return;
			}

			plus.nativeUI.showWaiting("正在提交，请稍候");
			mui.ajax(baseServiceUrl.url, {
				data: {
					serviceCode: "old.edoc.backDaiBanTask",
					assignmentId: assignmentId,
					formId: formId,
					actors: nextActors,
					actDefUniqueId: nextActId,
					opinion: opinion
				},
				dataType: 'json',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
				},
				type: "post",
				timeout: 300000, //超时时间设置为10秒；
				success: function(datas) {
					try {
						var data = JSON.parse(datas.result);
						if (data.status == "true") {
							//获得列表界面的webview
							var taskExecPage = plus.webview.getWebviewById('12_edoc/html/edoc/tasklist/daiban/daiban.html');
							//触发列表界面的自定义事件（refresh）,从而进行数据刷新
							mui.fire(taskExecPage, 'initLoadParams', {});
							mui.alert("提交成功！", function() {
								mui.openWindow({
									id: "daiban/daiban.html",
									url: "../daiban/daiban.html",
									show: {
										aniShow: 'pop-in',
										duration: 250
									},
									//createNew:true,
									waiting: {
										autoShow: false, //自动显示等待框，默认为true
									},
									styles: {
										cachemode: "noCache"
									}
								});
								//plus.webview.currentWebview().close();
							});
							mask.close();
							plus.nativeUI.closeWaiting();

						}
						if (datas.errMsg) {
							plus.nativeUI.toast(datas.errMsg);
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}
						if (datas.result == "") {
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}

						if (datas.result.indexOf("\r\n\r\n<html>") == 0) {
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}

						if (datas.result ==
							"<script type=\"text/javascript\" languge=\"javascript\">window.location.href='/portal/jsp/public/login.jsp'\<\/script>"
						) {
							plus.nativeUI.toast("您已下线，请重新登录");
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}
						if (data.errMsg) {
							plus.nativeUI.toast(data.errMsg);
							mask.close();
							plus.nativeUI.closeWaiting();
							return;
						}
					} catch (err) {
						plus.nativeUI.toast("系统错误，无法进行提交操作");
						plus.nativeUI.closeWaiting();
						mask.close();
					}

				},
				error: function(xhr, type, errorThrown) {
					plus.nativeUI.closeWaiting();
					mask.close();
					mui.toast("获取数据失败,请检查网络是否畅通");
				}
			});
		}
		//textarea添加原生方法
		mui.ready(function() {
			mui('.mui-input-row textarea').input();
		});

		
	</script>

</html>
